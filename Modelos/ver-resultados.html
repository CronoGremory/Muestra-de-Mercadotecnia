<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resultados - Muestra Mercadológica</title>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    
    <link rel="stylesheet" href="../Estilos/styleflujos.css" type="text/css" />
  </head>

  <body>
    <div class="wrapper">
      <div class="contenido">
        <div class="admin-container">
          
          <header class="dashboard-header">
            <h1>Muestra Mercadológica</h1>
            <div class="user-info">
              <span id="team-name-display">Equipo: [Cargando...]</span>
              <a href="/Modelos/login.html" class="menu-link">
                <span class="hover-underline-animation">Cerrar Sesión</span>
              </a>
            </div>
          </header>

          <main class="admin-content" style="flex-grow: 1">
            <div class="content-wrap" style="padding: 25px 40px">
              
              <h2>Resultados del Proyecto: <span id="project-name">[Cargando...]</span></h2>

              <p
                id="award-banner"
                class="notice"
                style="
                  display: none; /* Oculto por defecto */
                  border-left-color: #e4007c;
                  background-color: rgba(228, 0, 124, 0.05);
                "
              >
                ¡Felicidades! Tu proyecto ha obtenido una distinción de
                <strong id="award-text" style="color: #e4007c">...</strong>.
              </p>

              <section class="results-summary" style="margin-bottom: 30px">
                <h3>Resumen de Calificación</h3>
                <ul style="list-style: none; padding: 0">
                  <li
                    style="
                      display: flex;
                      justify-content: space-between;
                      padding: 10px 0;
                      border-bottom: 1px dashed #ccc;
                    "
                  >
                    <strong style="color: #003153">Calificación Final:</strong>
                    <span id="final-score" style="font-size: 1.2em; font-weight: bold;">-- / 10</span>
                  </li>
                  <li
                    style="
                      display: flex;
                      justify-content: space-between;
                      padding: 10px 0;
                      border-bottom: 1px dashed #ccc;
                    "
                  >
                    <strong style="color: #003153">Reconocimiento:</strong>
                    <span id="recognition-text">--</span>
                  </li>
                </ul>
              </section>

              <section class="category-breakdown" style="margin-bottom: 30px">
                <h3>Desglose por Categoría</h3>
                
                <p
                  class="info-note"
                  style="
                    border-left-color: #99f2c8;
                    background-color: rgba(153, 242, 200, 0.2);
                  "
                >
                  Tu proyecto participó en la categoría:
                  <strong id="category-name" style="color: #003153"
                    >[Cargando...]</strong
                  >
                </p>

                <table class="data-table" style="width: 100%">
                  <thead>
                    <tr>
                      <th>Criterio de Evaluación</th>
                      <th>Puntuación Promedio</th>
                      </tr>
                  </thead>
                  <tbody id="criteria-body">
                    <tr>
                      <td colspan="2" style="text-align: center;">Cargando detalles...</td>
                    </tr>
                  </tbody>
                </table>
              </section>

              <div
                class="links"
                style="
                  margin-top: 30px;
                  padding-top: 20px;
                  border-top: 2px dashed #99f2c8;
                "
              >
                <a href="/Modelos/Equipo/dashboard_equipo_multicategoria.html" class="menu-link">
                   <span class="hover-underline-animation">&laquo; Volver al Panel</span>
                </a>

                <a href="descargar-constancia.html" class="menu-link" style="margin-left: 20px;">
                  <span class="hover-underline-animation">
                    Ir a Descargar Constancia
                  </span>
                </a>
              </div>
            </div>
          </main>

          <footer
            class="d-flex flex-wrap justify-content-center align-items-center py-3 mt-auto"
            style="background-color: #f0f0f0; width: 100%"
          >
            <div class="d-flex align-items-center justify-content-center">
              <img
                src="../Recursos/UAA-LOGO.png"
                alt="Logo UAA"
                style="height: 80px; margin-right: 15px"
                class="my-1"
              />
              <span class="mb-3 mb-md-0 text-dark">
                &copy; 2025 Muestra Mercadológica UAA
              </span>
            </div>
          </footer>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const idProyecto = urlParams.get('idProyecto');
        const userName = sessionStorage.getItem('userName');

        // 1. Mostrar nombre del equipo desde sesión
        if(userName) {
            document.getElementById('team-name-display').textContent = `Equipo: ${userName}`;
        }

        // 2. Validar ID de proyecto
        if (!idProyecto) {
            alert("Error: No se especificó un proyecto.");
            window.location.href = '/Modelos/Equipo/dashboard_equipo_multicategoria.html';
            return;
        }

        // 3. Llamar al API
        fetch(`/api/equipo/resultados?idProyecto=${idProyecto}`)
        .then(res => {
            if(!res.ok) throw new Error("Aún no hay resultados disponibles o hubo un error.");
            return res.json();
        })
        .then(data => {
            // Llenar datos generales
            document.getElementById('project-name').textContent = data.proyecto;
            document.getElementById('category-name').textContent = data.categoria;
            document.getElementById('final-score').textContent = data.calificacionFinal;
            document.getElementById('recognition-text').textContent = data.reconocimiento;

            // Mostrar banner si es algo especial (Mención honorífica, 1er lugar, etc.)
            if (data.reconocimiento !== "Participación") {
                const banner = document.getElementById('award-banner');
                const text = document.getElementById('award-text');
                text.textContent = data.reconocimiento;
                banner.style.display = 'block';
            }

            // Llenar tabla dinámicamente
            const tbody = document.getElementById('criteria-body');
            tbody.innerHTML = '';
            
            if(data.detalles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align:center;">Sin detalles disponibles.</td></tr>';
            } else {
                data.detalles.forEach(d => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${d.criterio}</td>
                        <td style="font-weight: bold; color: #003153;">${d.puntaje}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        })
        .catch(err => {
            document.querySelector('.content-wrap').innerHTML = `
                <h3 style="color:red; text-align:center; margin-top:50px;">${err.message}</h3> 
                <p style="text-align:center;">
                    <a href="/Modelos/Equipo/dashboard_equipo_multicategoria.html" class="btn btn-outline-dark">Volver al Panel</a>
                </p>`;
        });
      });
    </script>
  </body>
</html>