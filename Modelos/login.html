<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iniciar Sesión - Muestra Mercadológica 2025</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="../Estilos/styleflujos.css" />
  </head>

  <body>
    <div class="wrapper">
      <div class="contenido admin-container">
        
        <header class="dashboard-header">
          <h1>Muestra Mercadológica - Iniciar Sesión</h1>
          <div class="user-info">
            <span>Acceso al Sistema</span>
          </div>
        </header>

        <main class="admin-content">
          <div class="container login-container">
            <h2>Bienvenido</h2>

            <form id="loginForm">
              <div class="form-group">
                <label for="email">Correo Institucional:</label>
                <input type="email" id="email" name="email" required />
              </div>
              <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" name="password" required />
              </div>
              <button type="submit" class="animated-button">
                <span></span><span></span><span></span><span></span>Ingresar
              </button>
            </form>

            <div id="message" style="margin-top: 15px; text-align: center; font-weight: bold;"></div>

            <div class="user-info">
              <a href="/Modelos/recuperar-contraseña.html" class="menu-link">
                <span class="hover-underline-animation">
                  ¿Olvidaste tu contraseña?
                </span>
              </a>
            </div>
            <div class="user-info">
              <a href="/Modelos/registro.html" class="menu-link">
                <span class="hover-underline-animation">Registrar Nuevo Equipo</span>
              </a>
            </div>
            <div class="user-info">
              <a href="/Modelos/index.html" class="menu-link">
                <span class="hover-underline-animation">Volver al inicio</span>
              </a>
            </div>
          </div>
        </main>

        <footer
          class="d-flex flex-wrap justify-content-center align-items-center py-3 mt-auto"
          style="background-color: #f0f0f0; width: 100%"
        >
          <div class="d-flex align-items-center justify-content-center">
            <img
              src="../Recursos/UAA-LOGO.png"
              alt="Logo UAA"
              style="height: 80px; margin-right: 15px"
              class="my-1"
            />
            <span class="mb-3 mb-md-0 text-dark">
              &copy; 2025 Muestra Mercadológica UAA
            </span>
          </div>
        </footer>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      const loginForm = document.getElementById('loginForm');
      const messageDiv = document.getElementById('message');

      loginForm.addEventListener('submit', function(event) {
          event.preventDefault(); // Evita que la página se recargue

          const formData = new FormData(loginForm);

          // Conexión a la API
          fetch('/api/auth/login', {
              method: 'POST',
              body: formData
          })
          .then(response => {
              return response.json().then(data => ({ ok: response.ok, body: data }));
          })
          .then(({ ok, body }) => {
              if (ok) {
                  messageDiv.style.color = 'green';
                  messageDiv.textContent = body.message;
                  
                  // Guardar sesión
                  sessionStorage.setItem('userRole', body.role);
                  sessionStorage.setItem('userName', body.name);
                  sessionStorage.setItem('userId', body.userId);

                  const role = body.role; 

                  // Redirección basada en roles
                  setTimeout(() => {
                      if (role === 'Administrador') {
                          window.location.href = '/Modelos/Admin/dashboard_administrador.html';
                      } else if (role === 'Docente') {
                          window.location.href = '/Modelos/Docente/dashboard_docente.html';
                      } else if (role === 'Evaluador') {
                          window.location.href = '/Modelos/Evaluador/dashboard_evaluador.html';
                      } else if (role === 'Staff') {
                          window.location.href = '/Modelos/Staff/dashboard_staff.html';
                      } else if (role === 'Equipo') { 
                          window.location.href = '/Modelos/Equipo/dashboard_equipo_multicategoria.html';
                      } else {
                          console.warn('Rol no reconocido:', role);
                          window.location.href = '/Modelos/index.html';
                      }
                  }, 1000);

              } else {
                  messageDiv.style.color = 'red';
                  messageDiv.textContent = `Error: ${body.message}`;
              }
          })
          .catch(error => {
              console.error('Error en la petición de login:', error);
              messageDiv.style.color = 'red';
              messageDiv.textContent = 'No se pudo conectar con el servidor. Intenta de nuevo.';
          });
      });
    </script>
  </body>
</html>