<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Staff - Muestra Mercadológica</title>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    
    <link rel="stylesheet" href="/Estilos/styleflujos.css" />
  </head>

  <body>
    <div class="wrapper">
      <div class="contenido">
        <div class="admin-container">
          
          <header class="dashboard-header">
            <h1>Panel de Staff - Muestra Mercadológica</h1>
            <div class="user-info">
              <span id="user-name-display">Staff: [Cargando...]</span>
              <a href="#" id="logoutButton" class="menu-link">
                <span class="hover-underline-animation">Cerrar Sesión</span>
              </a>
            </div>
          </header>

          <div class="admin-main">
            
            <aside class="admin-nav">
              <h3>Menú del Staff</h3>
              <ul>
                <li>
                  <a href="/Modelos/Staff/dashboard_staff.html" class="menu-link active">
                    <span class="hover-underline-animation">Resumen General</span>
                  </a>
                </li>
                <li>
                  <a href="/Modelos/Staff/staff_proyectos_lista.html" class="menu-link">
                    <span class="hover-underline-animation">Ver Proyectos</span>
                  </a>
                </li>
              </ul>
            </aside>

            <main class="admin-content" style="flex-grow: 1">
              <h2 id="welcome-message">Resumen Rápido y Tareas</h2>
              <p>
                Desde este panel podrás monitorear el estado de los proyectos
                asignados y dar seguimiento.
              </p>

              <section
                class="stats-grid"
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                  gap: 20px;
                  margin-top: 20px;
                "
              >
                <div
                  class="quick-stat-staff"
                  style="
                    border-left: 5px solid #2405f2;
                    padding: 15px;
                    background-color: #f8faff;
                    border-radius: 8px;
                  "
                >
                  <h4>Proyectos Totales</h4>
                  <p 
                    id="total-projects"
                    style="font-size: 2em; color: #2405f2; font-weight: bold"
                  >
                    ...
                  </p>
                </div>

                <div
                  class="quick-stat-staff"
                  style="
                    border-left: 5px solid #d904cb; /* Estilo rosado */
                    padding: 15px;
                    background-color: #fff8fc;
                    border-radius: 8px;
                  "
                >
                  <h4 style="color: #d904cb">Pendientes de Revisión</h4>
                  <p 
                    id="pending-projects"
                    style="font-size: 2em; color: #d904cb; font-weight: bold"
                  >
                    ...
                  </p>
                </div>
              </section>

              <section style="margin-top: 40px">
                <h3>Tareas Rápidas / Recordatorios</h3>
                <ul style="list-style-type: disclosure-closed; padding-left: 20px">
                  <li>Verificar listado de asistencia para las conferencias.</li>
                  <li>Preparar material de bienvenida para los equipos.</li>
                  <li>Revisar últimas consultas en la sección de soporte.</li>
                </ul>
              </section>
            </main>
          </div>

          <footer
            class="d-flex flex-wrap justify-content-center align-items-center py-3 mt-auto"
            style="background-color: #f0f0f0; width: 100%"
          >
            <div class="d-flex align-items-center justify-content-center">
              <img
                src="../Recursos/UAA-LOGO.png"
                alt="Logo UAA"
                style="height: 80px; margin-right: 15px"
                class="my-1"
              />
              <span class="mb-3 mb-md-0 text-dark">
                &copy; 2025 Muestra Mercadológica UAA
              </span>
            </div>
          </footer>

        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // 1. Obtener datos de la sesión
        const userName = sessionStorage.getItem('userName');
        const userRole = sessionStorage.getItem('userRole');

        // 2. Validación de Seguridad (Rol)
        if (!userName || (userRole !== 'Staff' && userRole !== 'Administrador')) {
            window.location.href = '/Modelos/login.html';
            return;
        }

        // 3. Mostrar datos del usuario en la interfaz
        document.getElementById('user-name-display').textContent = `Staff: ${userName}`;
        // Combinamos el mensaje de bienvenida con el estilo visual
        document.getElementById('welcome-message').textContent = `Bienvenido, ${userName}`;

        // 4. Cargar estadísticas desde el API
        fetch('/api/staff/stats')
        .then(r => {
            if (!r.ok) throw new Error("Error de conexión");
            return r.json();
        })
        .then(data => {
            document.getElementById('total-projects').textContent = data.total;
            document.getElementById('pending-projects').textContent = data.pendientes;
        })
        .catch(err => console.error("Error cargando estadísticas:", err));

        // 5. Lógica de Cerrar Sesión (Limpiar almacenamiento)
        document.getElementById('logoutButton').addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.clear(); // Borra todo (usuario, rol, id) para que sea seguro
            window.location.href = '/Modelos/login.html';
        });
      });
    </script>
  </body>
</html>